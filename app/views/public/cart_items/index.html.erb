<!DOCTYPE html>
<html>
  <head>
    <title>商品一覧</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <%= stylesheet_link_tag    'cart_item', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'cart_item', 'data-turbolinks-track': 'reload' %>
  </head>

  <div class="container">
    <div class="row">
      <h4 class="col-md-3 offset-1 bg-light text-center mt-2">ショッピングカート</h4>
      <%= link_to "カートを空にする",  cart_items_destroy_all_path, method: :delete, class: "btn btn-sm btn-danger" %>
        <table class="table table-bordered border-dark">
          <thead class="thead-light">
            <tr>
              <th>商品名</th>
              <th>単価（税込）</th>
              <th>数量</th>
              <th>小計</th>
              <th></th>
            </tr>
           </thead>
  
          <tbody>
            <% @cart_items.each do |cart_item| %>
              <tr>
                <td><%#= attachment_image_tag Product, :image, format: 'jpeg', size: "100x100" %>
                    <%= cart_item.product.name %>
                </td>
                <td><%= ((cart_item.product.price * @tax)).to_i %></td>
                <td>
                  <%= form_with model: cart_item do |f| %>
                    <%= f.select :product_count, [*1..100] %>
                    <%= f.submit "変更する", class: "btn btn-sm btn-success"%>
                  <% end %>
                </td>
                <td><%= ((cart_item.product.price * @tax) * cart_item.product_count).to_i %></td>
                <td><%= link_to "削除する", cart_item_path(cart_item.id), method: :delete, class:"btn btn-sm btn-danger" %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
  
        <%= link_to '買い物を続ける', products_path, class: "btn btn-sm btn-primary" %>
  
        <table class="table table-bordered border-dark">
          <thead class="thead-light">
            <tr>
              <th>合計金額</th>
              <td><%= @sum %></td>
            </tr>
          </thead>
        </table>
  
        <%= link_to '情報入力に進む', new_order_path, class: "btn btn-md btn-success" %>
    </div>
  </div>